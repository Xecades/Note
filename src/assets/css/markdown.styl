@import "global.styl"

// @todo 完善标点挤压（写 js 脚本，临时用 font-feature-settings: "halt" 解决）

dualr(--block-extend, -0.5rem, -1rem);

schemer(--hr-color, lighten(black, 82%), cyan);
schemer(--heading-color, lighten($text-color, 10%), cyan);
schemer(--bold-color, #8f6ce4, cyan);

schemer(--checkbox-background, none, cyan);
schemer(--checkbox-background-checked, #56a0ef, cyan);

schemer(--blockquote-border, #d7d9da, cyan);
schemer(--blockquote-background, #f2f2f2b5, cyan);
schemer(--blockquote-text, lighten($text-color, 28%), cyan);

schemer(--inline-code-background, #edeeeedb, cyan);

schemer(--block-code-background, #fafafa, cyan);
schemer(--block-code-border, #ededed, cyan);
schemer(--block-code-text, #383a42, cyan);

schemer(--table-border, lighten(black, 89%), cyan);
schemer(--table-hover-background, alpha(black, 0.04), cyan);

schemer(--quote-color, lighten($text-color, 24%), cyan);
schemer(--quote-background-opacity, 0.35, 1);
schemer(--quote-background-invert, 0, 1);

.markdown
    /* 基础样式 */
    line-height: 1.73em;
    font-size: 1.06rem;
    // font-feature-settings: "halt";

    /* 段落 */
    p
        margin-top: 1em;
        margin-bottom: 1em;
        overflow-wrap: break-word;

    /* KaTeX 数学公式 */
    .katex
        font-size: 1.08em;

    .katex-display
        margin: 0.3em 2px;

    /* 锚点 */
    .header-anchor
        opacity: 0;
        font-family: "Georgia", "Times New Roman", serif;
        color: lighten(black, 65%);
        transition: color 0.1s, opacity 0.15s;
        user-select: none;
        padding: 0 7px;
        display: inline-block;
        margin: 0;

        &:hover
            color: darken($theme-color, 20%);

    .heading:hover .header-anchor
        opacity: 1;

    /* header 标签（h1 被 ban 掉了） */
    h2
        font-size: 1.6rem;
        line-height: 2.6rem;

    h3
        font-size: 1.4rem;
        line-height: 1.75rem;

    h4
        font-size: 1.125rem;
        line-height: 1.75rem;

    h5
        font-size: 1rem;
        line-height: 1.5rem;

    h6
        font-size: 0.875rem;
        line-height: 1.25rem;

    .heading
        position: relative;
        margin: 1.5rem 0;
        color: var(--heading-color);
        font-weight: 500;

    /* hr 标签 */
    hr
        margin: 3.2rem auto;
        width: 16rem;
        max-width: 80%;
        height: 1px;
        background-color: var(--hr-color);

    /* strong 标签 */
    strong
        font-weight: bold;
        color: var(--bold-color);

    .heading strong
        color: unset;
    
    figure strong
        color: unset;

    /* span.right 标签 */
    span.right
        display: block;
        text-align: right;

    /* em 标签 */
    em
        font-style: italic;

    /* 列表 */
    ul
        list-style: disc;

    ol
        list-style: decimal;

    :is(ul, ol)
        margin-left: 20px;

    :is(ul, ol) li
        padding-left: 5px;
        line-height: 2.5em;

    :is(ul, ol) li::marker
        color: lighten($text-color, 10%);

    /* checkbox */
    /* @see https://getcssscan.com/css-checkboxes-examples */
    /* @see https://github.com/linsir/markdown-it-task-checkbox */
    ul.task-list
        margin-left: unset;
        list-style: none;

        li
            text-indent: unset;

    .task-list-item
        *, ::after, ::before
            box-sizing: border-box;

        input[type="checkbox"]
            margin: 0;
            width: 0;
            height: 0;
            display: inline;
            appearance: none;

            + label:before
                content: "";
                display: inline-block;
                vertical-align: sub;
                height: 1em;
                width: 1em;
                margin-right: 0.6em;
                margin-bottom: 1.5px;
                color: #00000046;
                border: 0.06em solid;
                border-radius: 0.2em;
                background: "url(%s) no-repeat center, white" % $checkbox-svg;
                background-color: var(--checkbox-background);
                background-size: 0;

            &:checked + label:before
                background-color: var(--checkbox-background-checked);
                background-size: 0.75em;
                color: #00000013;

    /* 引言 */
    blockquote
        margin: 0.8em 0;
        padding: 0.2em 1em;
        border-left: 4px solid var(--blockquote-border);
        background-color: var(--blockquote-background);
        color: var(--blockquote-text);
        border-radius: 4px;
        font-size: 0.96em;

    > blockquote
        margin-left: var(--block-extend);
        margin-right: var(--block-extend);

    /* 行内代码块 */
    code.inline-code
        font-family: $monospace;
        background: var(--inline-code-background);
        border-radius: 2px;
        white-space: normal;
        font-size: 0.86em;
        line-height: 1em;
        padding: 0.15em 0.3em;
        word-break: break-word;
    
    .note .content code.inline-code,
    .fold .header code.inline-code
        background: var(--content-code-color);

    /* 行间代码块 */
    pre.block-code
        background: var(--block-code-background);
        border: 1px solid var(--block-code-border);
        padding: 1em 0.8em;
        margin: 1em var(--block-extend);
        border-radius: 2px;
        color: var(--block-code-text);
        font-family: $monospace;
        font-size: 0.93em;
        overflow: auto;
        word-spacing: normal;
        word-break: normal;
        line-height: 1.55;
        tab-size: 2;

        code
            background: unset;
            white-space: pre !important;
            padding: 0.2em 0;
            text-shadow: none;

        ::selection
            background-color: alpha($theme-color, 0.25);

    /* 表格 */
    table
        border-collapse: collapse;
        border: 1px solid var(--table-border);
        border-radius: 2px;
        display: block;
        width: max-content;
        margin: 1.5em auto;
        max-width: calc(100% - var(--block-extend) * 2);
        transform: translateX(var(--block-extend));
        overflow-x: auto;

        th
            font-weight: bold;
            padding: 0.6em 0.5em;
            text-align: unset;
            min-width: 5em;

        td
            padding: 0.6em 0.5em;
            border-top: 1px solid var(--table-border);

        tbody tr
            transition: background-color 0.05s;

            &:hover
                background-color: var(--table-hover-background);

    /* Snippet Quote */
    div.quote
        display: block;
        margin: 4.5em 0;
        padding: 0 3rem;
        color: var(--quote-color);
        text-align: center;
        position: relative;

        &::before, &::after
            position: absolute;
            display: block;
            height: 1.5em;
            width: 100%;
            margin: 0 -3rem;
            background-repeat: no-repeat;
            background-size: 22px 22px;
            content: "";
            opacity: var(--quote-background-opacity);
            filter: invert(var(--quote-background-invert));

        &::before
            top: -1.25em;
            background-image: url(@/assets/img/quote-left.svg);
            background-position: 0 -4px;

        &::after
            bottom: -1.25em;
            background-image: url(@/assets/img/quote-right.svg);
            background-position: 100% 7px;

    /* FontAwesome icons */
    svg.icon
        padding: 0 0.2em;
        font-size: 0.9em;
        opacity: 0.85;

    /* div.asterisk 标签 */
    div.asterisk::after
        content: "＊＊＊";
        text-align: center;
        color: lighten(black, 60%);
        font-size: 0.75em;
        margin: 4rem 0;
        letter-spacing: 6px;
        user-select: none;
        display: block;

/* Note & Fold color theme */
$types = "default" "info" "success" "warning" "danger"
$themes = #777777 #0070f3 #0fdb9d #f5a623 #ee0000
$alphas = 0.07 0.57 0.11 0.20
$dkAlphas = 0.11 0.9 0.22 0.22

for $c, $i in $themes
    .colors.{$types[$i]}
        scheme(--background-color, alpha($c, $alphas[0]), alpha($c, $dkAlphas[0]));
        scheme(--icon-color, alpha($c, $alphas[1]), alpha($c, $dkAlphas[1]));
        scheme(--content-code-color, alpha($c, $alphas[2]), alpha($c, $dkAlphas[2]));
        scheme(--border-color, alpha($c, $alphas[3]), alpha($c, $dkAlphas[3]));

// TODO
@media (max-width: 768px)
    :root
        --block-extend: -1rem;

    /* KaTeX 数学公式 */
    .markdown .katex
        font-size: 1em;

    .markdown .katex-display .katex
        font-size: 1rem;

    /* header 标签 */
    .markdown h2
        font-size: 1.5rem;
        line-height: 2.6rem;

    .markdown h3
        font-size: 1.35rem;

    .markdown h4
        font-size: 1.025rem;

    .markdown h5
        font-size: 0.9rem;
        line-height: 1.5rem;

    .markdown h6
        font-size: 0.8rem;

    /* hr 标签 */
    .markdown hr
        width: 12rem;

    /* 引言 */
    .markdown blockquote
        padding: 0.3rem 0.9rem;

    /* 表格 */
    .markdown table tbody tr:hover
        background-color: unset;
